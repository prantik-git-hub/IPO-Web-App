{% extends 'base.html' %}
{% load static %}
{% block title %}IPO Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
  <h2>Upcoming IPO | Dashboard</h2>

  <!-- Search and Filter -->
  <form class="row g-3 mb-4" method="get" action="{% url 'ipo_app:ipo-list' %}">
    <div class="col-md-6">
      <input type="text" class="form-control" name="q" placeholder="Search by company..." value="{{ request.GET.q }}">
    </div>
    <div class="col-md-4">
      <select class="form-select" name="status">
        <option value="">Filter by status</option>
        <option value="coming" {% if request.GET.status == 'coming' %}selected{% endif %}>Coming</option>
        <option value="newlisted" {% if request.GET.status == 'newlisted' %}selected{% endif %}>Newlisted</option>
        <option value="ongoing" {% if request.GET.status == 'ongoing' %}selected{% endif %}>Ongoing</option>
      </select>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">Apply</button>
    </div>
  </form>

  {% if ipos %}
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Company</th>
          <th>Price Band</th>
          <th>Open</th>
          <th>Close</th>
          <th>Issue Size</th>
          <th>Issue Type</th>
          <th>Listing Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for ipo in ipos %}
        <tr>
          <td>{{ ipo.company }}</td>
          <td>{{ ipo.price_band }}</td>
          <td>{{ ipo.open_date }}</td>
          <td>{{ ipo.close_date }}</td>
          <td>{{ ipo.issue_size }}</td>
          <td>{{ ipo.issue_type }}</td>
          <td>{{ ipo.listing_date }}</td>
          <td>{{ ipo.status|title }}</td>
          <td>
            <a href="{% url 'ipo_app:ipo-detail-page' ipo.id %}" class="btn btn-sm btn-outline-info" title="View">
              <i class="bi bi-eye"></i>
            </a>
            <a href="{% url 'ipo_app:ipo-edit' ipo.id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
            <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ ipo.id }}">
              <i class="bi bi-trash3"></i>
            </button>
          </td>
        </tr>

        <!-- Delete Modal -->
        <div class="modal fade" id="deleteModal{{ ipo.id }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <form method="post" action="{% url 'ipo_app:ipo-delete' ipo.id %}">
                {% csrf_token %}
                <div class="modal-header">
                  <h5 class="modal-title">Confirm Delete</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                  Are you sure you want to delete <strong>{{ ipo.company }}</strong> IPO?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-danger">Delete</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p class="text-muted">No IPOs found.</p>
  {% endif %}
</div>

<!-- Notifications -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999">
  {% if messages %}
    {% for message in messages %}
      <div class="toast align-items-center text-white bg-success border-0 show" role="alert">
        <div class="d-flex">
          <div class="toast-body">{{ message }}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
    {% endfor %}
  {% endif %}
</div>
{% endblock %}
